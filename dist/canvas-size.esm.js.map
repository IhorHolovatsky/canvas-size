{"version":3,"file":"canvas-size.esm.js","sources":["../src/index.js"],"sourcesContent":["// Constants & Variables\n// =============================================================================\nconst cvs      = document ? document.createElement('canvas') : null;\nconst ctx      = cvs && cvs.getContext ? cvs.getContext('2d') : null;\nconst defaults = {\n    step: 1024,\n    // Callbacks\n    onError  : Function.prototype,\n    onSuccess: Function.prototype\n};\n\n\n// Functions (Private)\n// =============================================================================\n/**\n * Tests ability to read pixel data from canvases of various dimensions by\n * decreasing canvas height and/or width until a success test occurs.\n *\n * @param {object} options\n * @param {number} options.minHeight\n * @param {number} options.maxHeight\n * @param {number} options.minWidth\n * @param {number} options.maxWidth\n * @param {number} options.step\n * @param {function} options.onError\n * @param {function} options.onSuccess\n * @param {function} [_settings]\n */\nfunction canvasLoop(options = {}, _settings) {\n    const settings = _settings || Object.assign({}, defaults, options);\n    const testPass = canvasTest(settings.maxHeight, settings.maxWidth);\n\n    if (testPass) {\n        settings.onSuccess(settings.maxHeight, settings.maxWidth);\n    }\n    else {\n        const isLargerThanMin = settings.maxHeight > settings.minHeight || settings.maxWidth > settings.minWidth;\n\n        settings.onError(settings.maxHeight, settings.maxWidth);\n\n        // Decrease value(s) by step amount and test again\n        if (isLargerThanMin) {\n            settings.maxWidth  = Math.max(settings.maxWidth - settings.step, settings.minWidth);\n            settings.maxHeight = Math.max(settings.maxHeight - settings.step, settings.minHeight);\n\n            // Test again with decreased values\n            setTimeout(function(){\n                canvasLoop(null, settings);\n            }, 0);\n        }\n    }\n}\n\n/**\n * Tests ability to read pixel data from canvas of specified dimensions.\n *\n * @param {number} height\n * @param {number} width\n * @returns {boolean}\n */\nfunction canvasTest(height, width) {\n    // Define test rectangle dimensions and coordinates\n    const w = 1;\n    const h = 1;\n    const x = width - w;  // Right edge\n    const y = height - h; // Bottom edge\n\n    try {\n        // Set sized canvas dimensions and draw test rectangle\n        cvs.width = width;\n        cvs.height = height;\n        ctx.fillRect(x, y, w, h);\n\n        // Verify test rectangle image data (Pass = 255, Fail = 0)\n        return Boolean(ctx.getImageData(x, y, w, h).data[3]);\n    }\n    catch(e){\n        return false;\n    }\n}\n\n\n// Export\n// =============================================================================\nconst canvasSize = {\n    /**\n     * Determines maximum canvas area. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=16384]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxArea(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: options.min || 1,\n            maxHeight: options.max || 16384,\n            minWidth : options.min || 1,\n            maxWidth : options.max || 16384\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Determines maximum canvas height. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=32767]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxHeight(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: options.min || 1,\n            maxHeight: options.max || 32767,\n            minWidth : 1,\n            maxWidth : 1\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Determines maximum canvas width. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=32767]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxWidth(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: 1,\n            maxHeight: 1,\n            minWidth : options.min || 1,\n            maxWidth : options.max || 32767\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Tests ability to read pixel data from canvas of specified dimensions.\n     *\n     * @param {object} [options]\n     * @param {number} [options.height=1]\n     * @param {number} [options.width=1]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    test(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            height: options.height || 1,\n            width : options.width || 1\n        });\n        const testPass = canvasTest(settings.height, settings.width);\n\n        if (testPass) {\n            settings.onSuccess(settings.height, settings.width);\n        }\n        else {\n            settings.onError(settings.height, settings.width);\n        }\n    }\n};\n\nexport default canvasSize;"],"names":["cvs","document","createElement","ctx","getContext","defaults","step","onError","Function","prototype","onSuccess","canvasLoop","options","_settings","settings","Object","assign","testPass","canvasTest","maxHeight","maxWidth","isLargerThanMin","minHeight","minWidth","Math","max","setTimeout","height","width","w","h","x","y","fillRect","Boolean","getImageData","data","e","canvasSize","maxArea","min","test"],"mappings":";;;;;;;AAEA,MAAMA,MAAWC,WAAWA,SAASC,cAAc,YAAY;;AAC/D,MAAMC,MAAWH,OAAOA,IAAII,aAAaJ,IAAII,WAAW,QAAQ;;AAChE,MAAMC,WAAW;IACbC,MAAM;IAENC,SAAWC,SAASC;IACpBC,WAAWF,SAASC;;;AAoBxB,SAASE;QAAWC,8EAAU;QAAIC;UACxBC,WAAWD,aAAaE,OAAOC,OAAO,IAAIX,UAAUO;UACpDK,WAAWC,WAAWJ,SAASK,WAAWL,SAASM;QAErDH,UAAU;QACVH,SAASJ,UAAUI,SAASK,WAAWL,SAASM;WAE/C;cACKC,kBAAkBP,SAASK,YAAYL,SAASQ,aAAaR,SAASM,WAAWN,SAASS;QAEhGT,SAASP,QAAQO,SAASK,WAAWL,SAASM;YAG1CC,iBAAiB;YACjBP,SAASM,WAAYI,KAAKC,IAAIX,SAASM,WAAWN,SAASR,MAAMQ,SAASS;YAC1ET,SAASK,YAAYK,KAAKC,IAAIX,SAASK,YAAYL,SAASR,MAAMQ,SAASQ;YAG3EI,WAAW;gBACPf,WAAW,MAAMG;eAClB;;;;;AAYf,SAASI,WAAWS,QAAQC;UAElBC,IAAI;UACJC,IAAI;UACJC,IAAIH,QAAQC;UACZG,IAAIL,SAASG;;QAIf9B,IAAI4B,QAAQA;QACZ5B,IAAI2B,SAASA;QACbxB,IAAI8B,SAASF,GAAGC,GAAGH,GAAGC;eAGfI,QAAQ/B,IAAIgC,aAAaJ,GAAGC,GAAGH,GAAGC,GAAGM,KAAK;MAErD,OAAMC;eACK;;;;AAOf,MAAMC,aAAa;IAafC;YAAQ3B,8EAAU;cACRE,WAAWC,OAAOC,OAAO,IAAIX,UAAUO,SAAS;YAClDU,WAAWV,QAAQ4B,OAAO;YAC1BrB,WAAWP,QAAQa,OAAO;YAC1BF,UAAWX,QAAQ4B,OAAO;YAC1BpB,UAAWR,QAAQa,OAAO;;QAG9Bd,WAAWG;;IAefK;YAAUP,8EAAU;cACVE,WAAWC,OAAOC,OAAO,IAAIX,UAAUO,SAAS;YAClDU,WAAWV,QAAQ4B,OAAO;YAC1BrB,WAAWP,QAAQa,OAAO;YAC1BF,UAAW;YACXH,UAAW;;QAGfT,WAAWG;;IAefM;YAASR,8EAAU;cACTE,WAAWC,OAAOC,OAAO,IAAIX,UAAUO,SAAS;YAClDU,WAAW;YACXH,WAAW;YACXI,UAAWX,QAAQ4B,OAAO;YAC1BpB,UAAWR,QAAQa,OAAO;;QAG9Bd,WAAWG;;IAYf2B;YAAK7B,8EAAU;cACLE,WAAWC,OAAOC,OAAO,IAAIX,UAAUO,SAAS;YAClDe,QAAQf,QAAQe,UAAU;YAC1BC,OAAQhB,QAAQgB,SAAS;;cAEvBX,WAAWC,WAAWJ,SAASa,QAAQb,SAASc;YAElDX,UAAU;YACVH,SAASJ,UAAUI,SAASa,QAAQb,SAASc;eAE5C;YACDd,SAASP,QAAQO,SAASa,QAAQb,SAASc;;;;;"}