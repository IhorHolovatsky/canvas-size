{"version":3,"file":"canvas-size.esm.min.js","sources":["../src/index.js"],"sourcesContent":["// Constants & Variables\n// =============================================================================\nconst cvs      = document ? document.createElement('canvas') : null;\nconst ctx      = cvs && cvs.getContext ? cvs.getContext('2d') : null;\nconst defaults = {\n    step: 1024,\n    // Callbacks\n    onError  : Function.prototype,\n    onSuccess: Function.prototype\n};\n\n\n// Functions (Private)\n// =============================================================================\n/**\n * Tests ability to read pixel data from canvases of various dimensions by\n * decreasing canvas height and/or width until a success test occurs.\n *\n * @param {object} options\n * @param {number} options.minHeight\n * @param {number} options.maxHeight\n * @param {number} options.minWidth\n * @param {number} options.maxWidth\n * @param {number} options.step\n * @param {function} options.onError\n * @param {function} options.onSuccess\n * @param {function} [_settings]\n */\nfunction canvasLoop(options = {}, _settings) {\n    const settings = _settings || Object.assign({}, defaults, options);\n    const testPass = canvasTest(settings.maxHeight, settings.maxWidth);\n\n    if (testPass) {\n        settings.onSuccess(settings.maxHeight, settings.maxWidth);\n    }\n    else {\n        const isLargerThanMin = settings.maxHeight > settings.minHeight || settings.maxWidth > settings.minWidth;\n\n        settings.onError(settings.maxHeight, settings.maxWidth);\n\n        // Decrease value(s) by step amount and test again\n        if (isLargerThanMin) {\n            settings.maxWidth  = Math.max(settings.maxWidth - settings.step, settings.minWidth);\n            settings.maxHeight = Math.max(settings.maxHeight - settings.step, settings.minHeight);\n\n            // Test again with decreased values\n            setTimeout(function(){\n                canvasLoop(null, settings);\n            }, 0);\n        }\n    }\n}\n\n/**\n * Tests ability to read pixel data from canvas of specified dimensions.\n *\n * @param {number} height\n * @param {number} width\n * @returns {boolean}\n */\nfunction canvasTest(height, width) {\n    // Define test rectangle dimensions and coordinates\n    const w = 1;\n    const h = 1;\n    const x = width - w;  // Right edge\n    const y = height - h; // Bottom edge\n\n    try {\n        // Set sized canvas dimensions and draw test rectangle\n        cvs.width = width;\n        cvs.height = height;\n        ctx.fillRect(x, y, w, h);\n\n        // Verify test rectangle image data (Pass = 255, Fail = 0)\n        return Boolean(ctx.getImageData(x, y, w, h).data[3]);\n    }\n    catch(e){\n        return false;\n    }\n}\n\n\n// Export\n// =============================================================================\nconst canvasSize = {\n    /**\n     * Determines maximum canvas area. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=16384]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxArea(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: options.min || 1,\n            maxHeight: options.max || 16384,\n            minWidth : options.min || 1,\n            maxWidth : options.max || 16384\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Determines maximum canvas height. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=32767]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxHeight(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: options.min || 1,\n            maxHeight: options.max || 32767,\n            minWidth : 1,\n            maxWidth : 1\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Determines maximum canvas width. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=32767]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxWidth(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: 1,\n            maxHeight: 1,\n            minWidth : options.min || 1,\n            maxWidth : options.max || 32767\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Tests ability to read pixel data from canvas of specified dimensions.\n     *\n     * @param {object} [options]\n     * @param {number} [options.height=1]\n     * @param {number} [options.width=1]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    test(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            height: options.height || 1,\n            width : options.width || 1\n        });\n        const testPass = canvasTest(settings.height, settings.width);\n\n        if (testPass) {\n            settings.onSuccess(settings.height, settings.width);\n        }\n        else {\n            settings.onError(settings.height, settings.width);\n        }\n    }\n};\n\nexport default canvasSize;"],"names":["cvs","document","createElement","ctx","getContext","defaults","step","onError","Function","prototype","onSuccess","canvasLoop","options","settings","Object","assign","canvasTest","maxHeight","maxWidth","isLargerThanMin","minHeight","minWidth","Math","max","setTimeout","height","width","x","y","fillRect","Boolean","getImageData","data","e","canvasSize","maxArea","min","test"],"mappings":";;;;;;;AAEA,MAAMA,IAAWC,SAAWA,SAASC,cAAc,UAAY,KACzDC,IAAWH,KAAOA,IAAII,WAAaJ,IAAII,WAAW,MAAQ,KAC1DC,SAAW,CACbC,KAAM,KAENC,QAAWC,SAASC,UACpBC,UAAWF,SAASC,WAoBxB,SAASE,iBAAWC,yDAAU,SACpBC,4CAAwBC,OAAOC,OAAO,GAAIV,SAAUO,MACzCI,WAAWH,EAASI,UAAWJ,EAASK,UAGrDL,EAASH,UAAUG,EAASI,UAAWJ,EAASK,cAE/C,OACKC,EAAkBN,EAASI,UAAYJ,EAASO,WAAaP,EAASK,SAAWL,EAASQ,SAEhGR,EAASN,QAAQM,EAASI,UAAWJ,EAASK,UAG1CC,IACAN,EAASK,SAAYI,KAAKC,IAAIV,EAASK,SAAWL,EAASP,KAAMO,EAASQ,UAC1ER,EAASI,UAAYK,KAAKC,IAAIV,EAASI,UAAYJ,EAASP,KAAMO,EAASO,WAG3EI,WAAW,WACPb,WAAW,KAAME,IAClB,KAYf,SAASG,WAAWS,EAAQC,SAIlBC,EAAID,EAFA,EAGJE,EAAIH,EAFA,aAMNzB,IAAI0B,MAAQA,EACZ1B,IAAIyB,OAASA,EACbtB,IAAI0B,SAASF,EAAGC,EATV,EACA,GAWCE,QAAQ3B,IAAI4B,aAAaJ,EAAGC,EAZ7B,EACA,GAWsCI,KAAK,IAErD,MAAMC,UACK,GAOf,MAAMC,WAAa,CAafC,cAAQvB,yDAAU,GAQdD,WAPiBG,OAAOC,OAAO,GAAIV,SAAUO,EAAS,CAClDQ,UAAWR,EAAQwB,KAAO,EAC1BnB,UAAWL,EAAQW,KAAO,MAC1BF,SAAWT,EAAQwB,KAAO,EAC1BlB,SAAWN,EAAQW,KAAO,UAkBlCN,gBAAUL,yDAAU,GAQhBD,WAPiBG,OAAOC,OAAO,GAAIV,SAAUO,EAAS,CAClDQ,UAAWR,EAAQwB,KAAO,EAC1BnB,UAAWL,EAAQW,KAAO,MAC1BF,SAAW,EACXH,SAAW,MAkBnBA,eAASN,yDAAU,GAQfD,WAPiBG,OAAOC,OAAO,GAAIV,SAAUO,EAAS,CAClDQ,UAAW,EACXH,UAAW,EACXI,SAAWT,EAAQwB,KAAO,EAC1BlB,SAAWN,EAAQW,KAAO,UAelCc,WAAKzB,yDAAU,SACLC,EAAWC,OAAOC,OAAO,GAAIV,SAAUO,EAAS,CAClDa,OAAQb,EAAQa,QAAU,EAC1BC,MAAQd,EAAQc,OAAS,IAEZV,WAAWH,EAASY,OAAQZ,EAASa,OAGlDb,EAASH,UAAUG,EAASY,OAAQZ,EAASa,OAG7Cb,EAASN,QAAQM,EAASY,OAAQZ,EAASa"}