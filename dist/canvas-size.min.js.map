{"version":3,"file":"canvas-size.min.js","sources":["../src/index.js"],"sourcesContent":["// Constants & Variables\n// =============================================================================\nconst cvs      = document ? document.createElement('canvas') : null;\nconst ctx      = cvs && cvs.getContext ? cvs.getContext('2d') : null;\nconst defaults = {\n    step: 1024,\n    // Callbacks\n    onError  : Function.prototype,\n    onSuccess: Function.prototype\n};\n\n\n// Functions (Private)\n// =============================================================================\n/**\n * Tests ability to read pixel data from canvases of various dimensions by\n * decreasing canvas height and/or width until a success test occurs.\n *\n * @param {object} options\n * @param {number} options.minHeight\n * @param {number} options.maxHeight\n * @param {number} options.minWidth\n * @param {number} options.maxWidth\n * @param {number} options.step\n * @param {function} options.onError\n * @param {function} options.onSuccess\n * @param {function} [_settings]\n */\nfunction canvasLoop(options = {}, _settings) {\n    const settings = _settings || Object.assign({}, defaults, options);\n    const testPass = canvasTest(settings.maxHeight, settings.maxWidth);\n\n    if (testPass) {\n        settings.onSuccess(settings.maxHeight, settings.maxWidth);\n    }\n    else {\n        const isLargerThanMin = settings.maxHeight > settings.minHeight || settings.maxWidth > settings.minWidth;\n\n        settings.onError(settings.maxHeight, settings.maxWidth);\n\n        // Decrease value(s) by step amount and test again\n        if (isLargerThanMin) {\n            settings.maxWidth  = Math.max(settings.maxWidth - settings.step, settings.minWidth);\n            settings.maxHeight = Math.max(settings.maxHeight - settings.step, settings.minHeight);\n\n            // Test again with decreased values\n            setTimeout(function(){\n                canvasLoop(null, settings);\n            }, 0);\n        }\n    }\n}\n\n/**\n * Tests ability to read pixel data from canvas of specified dimensions.\n *\n * @param {number} height\n * @param {number} width\n * @returns {boolean}\n */\nfunction canvasTest(height, width) {\n    // Define test rectangle dimensions and coordinates\n    const w = 1;\n    const h = 1;\n    const x = width - w;  // Right edge\n    const y = height - h; // Bottom edge\n\n    try {\n        // Set sized canvas dimensions and draw test rectangle\n        cvs.width = width;\n        cvs.height = height;\n        ctx.fillRect(x, y, w, h);\n\n        // Verify test rectangle image data (Pass = 255, Fail = 0)\n        return Boolean(ctx.getImageData(x, y, w, h).data[3]);\n    }\n    catch(e){\n        return false;\n    }\n}\n\n\n// Export\n// =============================================================================\nconst canvasSize = {\n    /**\n     * Determines maximum canvas area. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=16384]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxArea(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: options.min || 1,\n            maxHeight: options.max || 16384,\n            minWidth : options.min || 1,\n            maxWidth : options.max || 16384\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Determines maximum canvas height. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=32767]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxHeight(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: options.min || 1,\n            maxHeight: options.max || 32767,\n            minWidth : 1,\n            maxWidth : 1\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Determines maximum canvas width. Tests begins with the `max` value which\n     * is then reduced by the `step` value until a successful test pass or the\n     * `min` value is reached.\n     *\n     * @param {object} [options]\n     * @param {number} [options.min=1]\n     * @param {number} [options.max=32767]\n     * @param {number} [options.step=1024]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    maxWidth(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            minHeight: 1,\n            maxHeight: 1,\n            minWidth : options.min || 1,\n            maxWidth : options.max || 32767\n        });\n\n        canvasLoop(settings);\n    },\n\n    /**\n     * Tests ability to read pixel data from canvas of specified dimensions.\n     *\n     * @param {object} [options]\n     * @param {number} [options.height=1]\n     * @param {number} [options.width=1]\n     * @param {function} [options.onError]\n     * @param {function} [options.onSuccess]\n     */\n    test(options = {}) {\n        const settings = Object.assign({}, defaults, options, {\n            height: options.height || 1,\n            width : options.width || 1\n        });\n        const testPass = canvasTest(settings.height, settings.width);\n\n        if (testPass) {\n            settings.onSuccess(settings.height, settings.width);\n        }\n        else {\n            settings.onError(settings.height, settings.width);\n        }\n    }\n};\n\nexport default canvasSize;"],"names":["cvs","document","createElement","ctx","getContext","defaults","step","onError","Function","prototype","onSuccess","canvasLoop","options","settings","_extends","canvasTest","maxHeight","maxWidth","isLargerThanMin","minHeight","minWidth","Math","max","setTimeout","height","width","x","y","fillRect","Boolean","getImageData","data","e","maxArea","min","test"],"mappings":";;;;;;;qYAEA,IAAMA,EAAWC,SAAWA,SAASC,cAAc,UAAY,KACzDC,EAAWH,GAAOA,EAAII,WAAaJ,EAAII,WAAW,MAAQ,KAC1DC,EAAW,CACbC,KAAM,KAENC,QAAWC,SAASC,UACpBC,UAAWF,SAASC,WAoBxB,SAASE,QAAWC,yDAAU,GACpBC,4CAAwBC,EAAc,GAAIT,EAAUO,MACzCG,EAAWF,EAASG,UAAWH,EAASI,UAGrDJ,EAASH,UAAUG,EAASG,UAAWH,EAASI,cAE/C,KACKC,EAAkBL,EAASG,UAAYH,EAASM,WAAaN,EAASI,SAAWJ,EAASO,SAEhGP,EAASN,QAAQM,EAASG,UAAWH,EAASI,UAG1CC,IACAL,EAASI,SAAYI,KAAKC,IAAIT,EAASI,SAAWJ,EAASP,KAAMO,EAASO,UAC1EP,EAASG,UAAYK,KAAKC,IAAIT,EAASG,UAAYH,EAASP,KAAMO,EAASM,WAG3EI,WAAW,WACPZ,EAAW,KAAME,IAClB,KAYf,SAASE,EAAWS,EAAQC,OAIlBC,EAAID,EAFA,EAGJE,EAAIH,EAFA,aAMNxB,EAAIyB,MAAQA,EACZzB,EAAIwB,OAASA,EACbrB,EAAIyB,SAASF,EAAGC,EATV,EACA,GAWCE,QAAQ1B,EAAI2B,aAAaJ,EAAGC,EAZ7B,EACA,GAWsCI,KAAK,IAErD,MAAMC,UACK,SAOI,CAafC,uBAAQrB,yDAAU,GAQdD,EAPiBG,EAAc,GAAIT,EAAUO,EAAS,CAClDO,UAAWP,EAAQsB,KAAO,EAC1BlB,UAAWJ,EAAQU,KAAO,MAC1BF,SAAWR,EAAQsB,KAAO,EAC1BjB,SAAWL,EAAQU,KAAO,UAkBlCN,yBAAUJ,yDAAU,GAQhBD,EAPiBG,EAAc,GAAIT,EAAUO,EAAS,CAClDO,UAAWP,EAAQsB,KAAO,EAC1BlB,UAAWJ,EAAQU,KAAO,MAC1BF,SAAW,EACXH,SAAW,MAkBnBA,wBAASL,yDAAU,GAQfD,EAPiBG,EAAc,GAAIT,EAAUO,EAAS,CAClDO,UAAW,EACXH,UAAW,EACXI,SAAWR,EAAQsB,KAAO,EAC1BjB,SAAWL,EAAQU,KAAO,UAelCa,oBAAKvB,yDAAU,GACLC,EAAWC,EAAc,GAAIT,EAAUO,EAAS,CAClDY,OAAQZ,EAAQY,QAAU,EAC1BC,MAAQb,EAAQa,OAAS,IAEZV,EAAWF,EAASW,OAAQX,EAASY,OAGlDZ,EAASH,UAAUG,EAASW,OAAQX,EAASY,OAG7CZ,EAASN,QAAQM,EAASW,OAAQX,EAASY"}